(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function i(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=i(o);fetch(o.href,s)}})();const at="modulepreload",rt=function(e){return"/"+e},De={},We=function(t,i,r){let o=Promise.resolve();if(i&&i.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),g=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));o=Promise.allSettled(i.map(S=>{if(S=rt(S),S in De)return;De[S]=!0;const X=S.endsWith(".css"),st=X?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${S}"]${st}`))return;const M=document.createElement("link");if(M.rel=X?"stylesheet":at,X||(M.as="script"),M.crossOrigin="",M.href=S,g&&M.setAttribute("nonce",g),document.head.appendChild(M),X)return new Promise((lt,it)=>{M.addEventListener("load",lt),M.addEventListener("error",()=>it(new Error(`Unable to preload CSS for ${S}`)))})}))}function s(c){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=c,window.dispatchEvent(g),!g.defaultPrevented)throw c}return o.then(c=>{for(const g of c||[])g.status==="rejected"&&s(g.reason);return t().catch(s)})},ct=new Tone.MonoSynth({oscillator:{type:"sawtooth"},envelope:{attack:.02,decay:.1,sustain:.2,release:.4}}).toDestination(),dt=new Tone.MonoSynth({oscillator:{type:"square"},filter:{type:"lowpass",frequency:200},envelope:{attack:.01,decay:.2,sustain:.3,release:.8}}).toDestination(),ut=new Tone.MembraneSynth().toDestination();Tone.Transport.bpm.value=160;const ht=["C4","E4","G4","B4","C5","B4","G4","E4","D4","F4","A4","C5","D5","A4","F4","D4"],ft=["C2","C2","G1","C2","B1","G1","C2","G1"],he=new Tone.Sequence((e,t)=>{ct.triggerAttackRelease(t,"16n",e)},ht,"16n"),qe=new Tone.Sequence((e,t)=>{dt.triggerAttackRelease(t,"8n",e),ut.triggerAttackRelease("C2","8n",e)},ft,"8n");he.loop=!0;qe.loop=!0;Tone.Transport.loop=!0;Tone.Transport.loopEnd="90s";function Ue(){Tone.start(),he.state!=="started"&&(he.start(0),qe.start(0)),Tone.Transport.start()}function yt(){Tone.Transport.stop()}function C(e,t){try{const i=localStorage.getItem(e);return i!==null?JSON.parse(i):t}catch{return t}}function u(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch{}}function $e(){const e=new URLSearchParams(location.search).get("ui");return e==="new"?!0:e==="old"?!1:C("newUi",!1)}function fe(e){u("newUi",!!e)}const a=document.getElementById("game"),l=a.getContext("2d"),_e={wallBounceEnabledDefault:!0,wallSlideMaxDownSpeed:120},d={settings:{wallBounceEnabled:C("wallBounceEnabled",_e.wallBounceEnabledDefault),speedMultiplier:1,musicEnabled:C("musicEnabled",!0),continuousPlay:!0}},W=document.getElementById("mainMenu"),Fe=document.getElementById("arcadeBtn"),gt=document.getElementById("boosterBtn"),mt=document.getElementById("settingsBtn"),Ce=document.getElementById("settingsMenu"),pt=document.getElementById("backBtn"),wt=document.getElementById("difficulty"),je=document.getElementById("gameContainer"),ee=document.getElementById("currentScore"),I=document.getElementById("comboDisplay"),Et=document.getElementById("scoreTable"),xe=document.getElementById("gameOver"),ye=document.getElementById("saveScoreBtn"),Ne=document.getElementById("newGameBtn"),ae=document.getElementById("boosterFrames"),Z=document.getElementById("wheelOverlay"),re=document.getElementById("spinBtn"),G=document.getElementById("spinWheel"),P=G.getContext("2d"),bt=document.getElementById("shopBtn"),He=document.getElementById("shopMenu"),Bt=document.getElementById("shopBackBtn"),J=document.getElementById("buySlotItem"),Pe=document.getElementById("ringDisplay"),Te=document.getElementById("shopRingDisplay"),Q=document.getElementById("shopMessage"),Ae=document.getElementById("refundBtn"),Oe=document.getElementById("resetGameBtn"),F=document.querySelectorAll(".character-item");let v=C("purchasedCharacters",["character.png"]),x=C("selectedCharacter","character.png");F.forEach(e=>{v.includes(e.dataset.character)&&e.classList.add("owned")});let f=C("ringCount",0),se=!1,_=!1,D=Array.from(document.querySelectorAll(".booster-frame")),L=Array(D.length).fill(""),k=C("extraSkillSlots",0);function Ye(){const e=document.createElement("div");e.classList.add("booster-frame"),ae.appendChild(e),D.push(e),L.push("")}function Ve(){for(;D.length>3;){const e=D.pop();ae.removeChild(e),L.pop()}}for(let e=0;e<k;e++)Ye();ce();let N=0,Je=0,te=0,ze=0,ge=0;const Ke=["red","yellow","green","blue","red","yellow","green","blue"];let me=0;const pe=document.getElementById("toggleWallBounce"),kt=document.getElementById("speedMinus"),It=document.getElementById("speedPlus"),vt=document.getElementById("speedValue"),we=document.getElementById("toggleMusic"),ne=document.getElementById("useNewUi");pe.checked=d.settings.wallBounceEnabled;we.checked=d.settings.musicEnabled;ne.checked=$e();function Se(){vt.textContent=d.settings.speedMultiplier.toFixed(1)+"x"}Se();pe.addEventListener("change",()=>{d.settings.wallBounceEnabled=pe.checked,u("wallBounceEnabled",d.settings.wallBounceEnabled)});kt.addEventListener("click",()=>{d.settings.speedMultiplier=Math.max(.5,d.settings.speedMultiplier-.5),Se()});It.addEventListener("click",()=>{d.settings.speedMultiplier=Math.min(3,d.settings.speedMultiplier+.5),Se()});we.addEventListener("change",()=>{d.settings.musicEnabled=we.checked,u("musicEnabled",d.settings.musicEnabled),d.settings.musicEnabled?Ue():yt()});ne.addEventListener("change",async()=>{const e=ne.checked;fe(e);const t=document.getElementById("ui-root"),i=document.getElementById("mainMenu"),r=document.getElementById("settingsMenu");if(e){t&&(t.style.display="block"),i&&(i.style.display="none"),r&&(r.style.display="none");try{(await We(()=>import("./bootstrapPreact-w53xUFNM-KseoUffr.js"),[])).mount()}catch(o){console.error(o),i&&(i.style.display="block"),t&&(t.style.display="none",t.innerHTML=""),r&&(r.style.display="none"),ne.checked=!1,fe(!1)}}else t&&(t.style.display="none",t.innerHTML=""),r&&(r.style.display="none"),i&&(i.style.display="block")});function E(){Pe&&(Pe.textContent=`Obręcze: ${f}`),Te&&(Te.textContent=`Obręcze: ${f}`)}function Ee(e){Q&&(Q.textContent=e,Q.style.display="block",setTimeout(()=>{Q.style.display="none"},5e3))}function ce(){J&&(k>0?J.classList.add("purchased"):J.classList.remove("purchased"))}function Ct(){f+=k*50,f+=(v.length-1)*50,k=0,v=["character.png"],x="character.png",u("ringCount",f),u("extraSkillSlots",k),u("purchasedCharacters",v),u("selectedCharacter",x),Ve(),F.forEach(e=>{e.classList.remove("owned"),e.dataset.character==="character.png"&&e.classList.add("owned")}),E(),ce(),K()}function xt(){f=0,k=0,v=["character.png"],x="character.png",u("ringCount",f),u("extraSkillSlots",k),u("purchasedCharacters",v),u("selectedCharacter",x),Ve(),F.forEach(e=>{e.classList.remove("owned"),e.dataset.character==="character.png"&&e.classList.add("owned")}),E(),ce(),K()}E();function St(){const e=G.width/2;for(let t=0;t<8;t++){P.beginPath(),P.moveTo(e,e);const i=-Math.PI/2+t*Math.PI/4,r=i+Math.PI/4;P.arc(e,e,e,i,r),P.fillStyle=Ke[t],P.fill(),P.strokeStyle="#000",P.stroke()}}St();function Mt(){Z.style.display="flex",re.textContent="Spin!",G.style.transition="none",G.style.transform="rotate(0deg)",se=!1,_=!1}re.addEventListener("click",()=>{if(!se&&!_){_=!0;const e=5+Math.floor(Math.random()*6);me=Math.floor(Math.random()*8);const t=e*360-me*45-22.5;requestAnimationFrame(()=>{G.style.transition="transform 4s ease-in-out",G.style.transform=`rotate(${t}deg)`})}else se&&!_&&(Z.style.display="none",j=!1)});G.addEventListener("transitionend",()=>{if(_){_=!1,se=!0,re.textContent="Continue";const e=Ke[me];Lt(e)}});function Lt(e){D[N].style.backgroundColor=e,L[N]=e,N=(N+1)%D.length,Xe()}function Ze(){L=Array(D.length).fill(""),N=0;for(let e of D)e.style.backgroundColor="",e.style.borderColor="#000";Xe()}function Xe(){if(Je=L.filter(e=>e==="red").length,te=L.filter(e=>e==="yellow").length,ze=L.filter(e=>e==="green").length,ge=L.filter(e=>e==="blue").length,R=ke*(1+.25*ge),h){for(let e of h)if(e.id!==0&&e!==nt){const t=e.x+e.width/2;e.width=R,e.x=Math.min(Math.max(t-e.width/2,m),m+w-e.width)}}}mt.addEventListener("click",()=>{W.style.display="none",Ce.style.display="block"});pt.addEventListener("click",()=>{Ce.style.display="none",W.style.display="block",E()});bt.addEventListener("click",()=>{W.style.display="none",He.style.display="block",E()});Bt.addEventListener("click",()=>{He.style.display="none",W.style.display="block",E()});Ae&&Ae.addEventListener("click",()=>{Ct()});Oe&&Oe.addEventListener("click",()=>{xt()});J&&J.addEventListener("click",()=>{if(k>0){Ee("Przedmiot już zakupiony");return}f>=50?(f-=50,u("ringCount",f),E(),Ye(),k=1,u("extraSkillSlots",k),ce()):(Ee("Brak środków!"),E())});F.length&&F.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.character;if(v.includes(t)){x=t,u("selectedCharacter",t),K();return}f>=50?(f-=50,v.push(t),u("ringCount",f),u("purchasedCharacters",v),x=t,u("selectedCharacter",t),e.classList.add("owned"),E(),K()):Ee("Brak środków!")})});let B=new Image,H=null,z=[],de=0,be=0,q=null;const ue=150;function Dt(){z=["YmFja2dyb3VuZDEuanBn","YmFja2dyb3VuZDIuanBn","YmFja2dyb3VuZDMuanBn"].map(t=>`assets/${atob(t)}`),B.src=z[0]}Dt();function Pt(e){z.length>1&&(H=B,de=(de+1)%z.length,B=new Image,B.src=z[de],q=e)}const Be=new Image;Be.src="assets/step.jpg";const le=new Image;le.src=`assets/${x}`;function K(){le.src=`assets/${x}`,F.forEach(e=>{e.dataset.character===x?e.classList.add("selected"):e.classList.remove("selected")})}K();const Tt={easy:{platformWidth:90,speed:1.5},medium:{platformWidth:70,speed:2.5},hard:{platformWidth:50,speed:3.5}},T=20,At=2,ie=15;function Me(){const e=C("scores",[]);Et.textContent=e.map((t,i)=>`${i+1}. ${t.name}: ${t.score}`).join(`
`)}Me();function Qe(){Ze(),W.style.display="none",je.style.display="block",Z.style.display="none",ae.style.display=d.settings.continuousPlay?"none":"flex",a.width=600,a.height=window.innerHeight;const e=Tt[wt.value];Wt(e),d.settings.musicEnabled&&Ue(),requestAnimationFrame(ot)}function Ot(){d.settings.continuousPlay=!0,Qe()}function Rt(){d.settings.continuousPlay=!1,Qe()}Fe.addEventListener("click",Ot);gt.addEventListener("click",Rt);document.addEventListener("keydown",e=>{Z.style.display!=="none"&&e.code==="Space"?re.click():xe.style.display!=="none"&&e.code==="Space"?Ne.click():W.style.display!=="none"&&e.code==="Space"?Fe.click():j&&e.code==="Space"&&(j=!1)});const Gt=.5;let ke=90,R=90,et=2,n,h,A,Le,Y,O,Ie=!1,w,m,ve,tt,y,U,p,b,$,oe,V=0;const Re=30;let j=!1,nt=null;function Wt(e){ke=e.platformWidth,R=ke*(1+.25*ge),et=e.speed,w=Math.min(600,a.width),m=(a.width-w)/2,n={x:m+w/2-20,y:a.height-T-90,width:40,height:90,vx:0,vy:0,onGround:!0,lastPlatformId:0,isCombo:!1,wallBounceCount:0,wallContactDir:0,rotation:0,flipDir:0,flipping:!1},n.tryWallBounce=function(){return this.wallContactDir===0||this.wallBounceCount>0?!1:(this.wallBounceCount=1,this.vx=-this.wallContactDir*4*d.settings.speedMultiplier,this.vy=-20*Math.pow(2,ze)*d.settings.speedMultiplier,this.flipping=!0,this.rotation=0,this.flipDir=-this.wallContactDir,!0)},h=[];const t=Math.ceil(a.height/100);ve=(a.height-T)/(t-1),h.push({x:m,y:a.height-T,width:w,height:T,id:0}),b=[];for(let i=1;i<t;i++){const r={x:m+Math.random()*(w-R),y:a.height-T-i*ve,width:R,height:T,id:i};h.push(r),i%20===0&&b.push({x:r.x+r.width/2,y:r.y-ie,radius:ie})}tt=t,y=1,U=0,$=!1,p=[],A={},Le=!1,Y=!1,O=0,oe=0,ee.style.color="#fff",Ie=!1,V=0,j=!1}document.addEventListener("keydown",e=>{A[e.code]=!0});document.addEventListener("keyup",e=>{A[e.code]=!1});function qt(e){const t=A.ArrowLeft||A.KeyA,i=A.ArrowRight||A.KeyD;if(n.isCombo=y>1,t?n.vx=-4*d.settings.speedMultiplier:i?n.vx=4*d.settings.speedMultiplier:n.vx=0,n.onGround&&V<=0){let o=1;$&&y>=4&&(o=y/2,$=!1),o*=1+.25*Je,n.vy=-20*o*d.settings.speedMultiplier,n.onGround=!1,Y||(Y=!0),V=Re}else V--;if(n.vy+=Gt*d.settings.speedMultiplier,n.wallContactDir!==0&&(n.wallContactDir===-1&&t||n.wallContactDir===1&&i)){const o=_e.wallSlideMaxDownSpeed/60*d.settings.speedMultiplier;n.vy=Math.min(n.vy,o)}n.x+=n.vx,n.y+=n.vy,n.flipping&&(n.rotation+=n.flipDir*.3,Math.abs(n.rotation)>=Math.PI*2&&(n.flipping=!1,n.rotation=0));const r=n.wallContactDir;n.wallContactDir=0,n.x<m&&(n.x=m,n.wallContactDir=-1),n.x+n.width>m+w&&(n.x=m+w-n.width,n.wallContactDir=1),d.settings.wallBounceEnabled&&n.wallContactDir!==0&&r===0&&n.tryWallBounce()&&(V=Re,n.wallContactDir=0),n.onGround=!1;for(let o of h)if(n.x<o.x+o.width&&n.x+n.width>o.x&&n.y+n.height>o.y&&n.y+n.height<o.y+o.height+n.vy&&n.vy>=0){n.y=o.y-n.height,n.vy=0,n.onGround=!0,n.wallBounceCount=0;const s=o.id-n.lastPlatformId;if(s-1>=4?(oe=60,y===1?(y=2,U=0,$=!1):U++,O+=Math.round(s*y*(1+.25*te)),U>=y&&(y+=2,U=0,y>=4&&($=!0))):(O+=Math.round(s*(1+.25*te)),y=1,U=0,$=!1),n.lastPlatformId=o.id,!d.settings.continuousPlay&&o.id!==0){const g=o.id<=200?100:200;o.id%g===0&&(j=!0,Mt())}}if(Y){let o=et*d.settings.speedMultiplier;if(n.y<a.height/2){const s=a.height/2-n.y;n.y=a.height/2;for(let c of h)c.y+=s;for(let c of p)c.y+=s;for(let c of b)c.y+=s;be+=s}n.onGround&&(n.y+=o);for(let s of h)s.y+=o;for(let s of p)s.y+=o;for(let s of b)s.y+=o;be+=o}if(y>1){const o=n.x+n.width/2,s=n.y+n.height,c=p[p.length-1];(!c||Math.hypot(o-c.x,s-c.y)>20)&&p.push({x:o,y:s,life:60})}for(let o=p.length-1;o>=0;o--)p[o].life--,p[o].life<=0&&p.splice(o,1);for(let o=b.length-1;o>=0;o--){const s=b[o];if(n.x<s.x+s.radius&&n.x+n.width>s.x-s.radius&&n.y<s.y+s.radius&&n.y+n.height>s.y-s.radius){b.splice(o,1),f++,u("ringCount",f),E(),O+=Math.round(1e3*(1+.25*te)),ee.style.color="gold",setTimeout(()=>ee.style.color="#fff",1e3);continue}s.y-s.radius>a.height&&b.splice(o,1)}if(ee.textContent=O,oe>0?(I.style.display="block",I.textContent="BOOST!",I.style.color="red",I.style.borderColor="red",oe--):y>1?(I.style.display="block",I.textContent=`KOMBO x${y}`,I.style.color="yellow",I.style.borderColor="yellow"):I.style.display="none",Y)for(;h.length&&h[0].y>a.height;){h.shift();const o=h[h.length-1],s={x:m+Math.random()*(w-R),y:o.y-ve,width:R,height:T,id:tt++};if(!d.settings.continuousPlay){const c=s.id<=200?100:200;s.id%c===0&&(s.x=m,s.width=w,nt=s,Pt(s))}h.push(s),s.id%20===0&&b.push({x:s.x+s.width/2,y:s.y-ie,radius:ie})}n.y>a.height&&(Le=!0)}function Ge(){l.clearRect(0,0,a.width,a.height);const e=be%a.height;if(H){if(l.drawImage(H,0,e-a.height,a.width,a.height),l.drawImage(H,0,e,a.width,a.height),q){const t=q.y;l.save(),l.beginPath(),l.rect(0,0,a.width,t),l.clip(),B.complete&&(l.drawImage(B,0,e-a.height,a.width,a.height),l.drawImage(B,0,e,a.width,a.height));const i=l.createLinearGradient(0,t-ue,0,t);i.addColorStop(0,"rgba(0,0,0,0)"),i.addColorStop(1,"rgba(0,0,0,1)"),l.globalCompositeOperation="destination-out",l.fillStyle=i,l.fillRect(0,t-ue,a.width,ue),l.restore(),l.globalCompositeOperation="source-over"}(!q||q.y>=a.height)&&(H=null,q=null)}else B.complete?(l.drawImage(B,0,e-a.height,a.width,a.height),l.drawImage(B,0,e,a.width,a.height)):(l.fillStyle="#88f",l.fillRect(0,0,a.width,a.height));for(let t of h)Be.complete?l.drawImage(Be,t.x,t.y,t.width,t.height):(l.fillStyle="#555",l.fillRect(t.x,t.y,t.width,t.height)),l.strokeStyle="#000",l.lineWidth=At,l.strokeRect(t.x,t.y,t.width,t.height);for(let t of b)l.strokeStyle="gold",l.lineWidth=5,l.beginPath(),l.arc(t.x,t.y,t.radius,0,Math.PI*2),l.stroke();for(let t of p)l.globalAlpha=t.life/60,Ut(t.x,t.y,5);l.globalAlpha=1,l.strokeStyle="#000",l.lineWidth=4,l.strokeRect(m,0,w,a.height),l.save(),l.translate(n.x+n.width/2,n.y+n.height/2),n.flipping&&l.rotate(n.rotation),le.complete?l.drawImage(le,-n.width/2,-n.height/2,n.width,n.height):(l.fillStyle="#0a0",l.fillRect(-n.width/2,-n.height/2,n.width,n.height)),l.restore()}function Ut(e,t,i){l.fillStyle="#ff0",l.beginPath();for(let r=0;r<5;r++){const o=(18+r*72)*Math.PI/180,s=(54+r*72)*Math.PI/180;l.lineTo(e+Math.cos(o)*i,t-Math.sin(o)*i),l.lineTo(e+Math.cos(s)*i*.5,t-Math.sin(s)*i*.5)}l.closePath(),l.fill()}function $t(){const e=document.getElementById("finalScore");e.textContent=`Gratulacje! Twój wynik: ${O}`,Me(),xe.style.display="flex",Ze()}ye.addEventListener("click",()=>{const e=document.getElementById("nickname"),t=document.getElementById("scoreTable"),i=e.value.trim()||"Anon",r=C("scores",[]);r.push({name:i,score:O}),r.sort((c,g)=>g.score-c.score),u("scores",r),Me();const o=new Blob([t.textContent],{type:"text/plain"}),s=document.createElement("a");s.href=URL.createObjectURL(o),s.download="scores.txt",s.click(),ye.disabled=!0});Ne.addEventListener("click",()=>{xe.style.display="none",W.style.display="block",Ce.style.display="none",je.style.display="none",Z.style.display="none",ae.style.display="none",document.getElementById("nickname").value="",ye.disabled=!1,E()});function ot(e){if(Le){Ie||(Ge(),$t(),Ie=!0);return}j||qt(),Ge(),requestAnimationFrame(ot)}if($e()){const e=document.getElementById("ui-root");e.style.display="block";const t=document.getElementById("mainMenu");t&&(t.style.display="none"),We(()=>import("./bootstrapPreact-w53xUFNM-KseoUffr.js"),[]).then(i=>i.mount()).catch(i=>{console.error(i),t&&(t.style.display="block"),e&&(e.style.display="none",e.innerHTML="");const r=document.getElementById("useNewUi");r&&(r.checked=!1),fe(!1)})}export{We as _};
